name: Learning GitHub Script

on:
  pull_request:

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Find Exisitng Comment
        uses: actions/github-script@v5
        id: find-comment
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
             const prComments = await github.rest.issues.listComments({
             issue_number: context.issue.number,
             owner: context.repo.owner,
             repo: context.repo.repo
             })

             console.log("Status" + prComments.status)
             let count = 0
             let commentId;
             for (const comment of prComments.data) {
              console.log("Count = " + count++)
              console.log(comment.body)
              
              //look for a tag of some kind here
              if (comment.body.includes("Your Terraform Plan")) {
                //set id
                commentId = comment.id
                break
              }
             }  

             //use id to update commnet, else create...
             if(commentId) {
               console.log("Should Update")
               github.rest.issues.updateComment({
                 comment_id: commentId,
                 owner: context.repo.owner,
                 repo: context.repo.repo,
                 body: 'I updated this comment at ' + Date.now()
               })
             }
             else {
               console.log("Should Add New")
               github.rest.issues.createComment({
                 issue_number: context.issue.number,
                 owner: context.repo.owner,
                 repo: context.repo.repo,
                 body: 'This is a brand new comment.'
               })
             }


             
           
